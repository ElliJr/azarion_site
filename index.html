<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/img/icone.ico" type="image/x-icon">
    <title>Azairon</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/login.css">
    <link rel="stylesheet" href="assets/css/loader.css">
    <link type="module" href="assets/js/main.js">

  </head>
  <body>
    <!-- HERO -->
    <div class="hero">
      <div class="campoUser">

        <h5 id="nameUser"></h5>
        <div onclick="sairBtn" id="sairBtn">Log out</div>
      </div>
      <div class="hero__inner">
        <h1 class="hero__title">Azairon</h1>
        <p class="hero__lead">
          Seu novo treinador inteligente.
          <br>Crie sua conta grátis e receba um treino completo em segundos.
        </p>
        <div class="building">
          <h1>Em construção, aguarde...</h1>
          <!-- From Uiverse.io by mobinkakei -->
          <div id="wifi-loader">
            <svg class="circle-outer" viewBox="0 0 86 86">
              <circle class="back" cx="43" cy="43" r="40"></circle>
              <circle class="front" cx="43" cy="43" r="40"></circle>
              <circle class="new" cx="43" cy="43" r="40"></circle>
            </svg>
            <svg class="circle-middle" viewBox="0 0 60 60">
              <circle class="back" cx="30" cy="30" r="27"></circle>
              <circle class="front" cx="30" cy="30" r="27"></circle>
            </svg>
            <svg class="circle-inner" viewBox="0 0 34 34">
              <circle class="back" cx="17" cy="17" r="14"></circle>
              <circle class="front" cx="17" cy="17" r="14"></circle>
            </svg>
            <div class="text" data-text="Building"></div>
          </div>
        </div>
        <button onclick="openModal()" id="openModal"
          class="btn btn--primary">Criar Conta</button>

        <!-- Modal Principal -->
      </div>
      <div id="main-modal" class="modal">
        <div class="modal-content">
          <!-- Abas -->
          <div class="tabs">
            <div id="tab-login" class="tab active"
              onclick="showLogin()">Login</div>
            <div id="tab-create" class="tab" onclick="showCreate()">Criar
              Conta</div>
          </div>

          <!-- LOGIN -->

          <div id="login-box">
            <input type="email" id="login-email" placeholder="Seu email">
            <input type="password" id="login-password"
              placeholder="Sua senha">
            <button id="btn-login">Entrar</button>
            <p class="error" id="login-error"></p>
          </div>
          <!-- CRIAR CONTA -->
          <div id="create-box" style="display: none;">
            <input type="text" id="create-apelido" placeholder="Seu apelido">
            <input type="email" id="create-email" placeholder="Seu email">
            <input type="password" id="create-password"
              placeholder="Sua senha">
            <button id="btn-create">Criar Conta</button>
            <p class="error" id="create-error"></p>
          </div>

          <button id="google-login" class>logar com google </button>
          <div class="close" onclick="closeModal()">Fechar</div>
        </div>
      </div>

      <!-- MENU LATERAL MOBILE -->
      <!-- <div id="menu-mobile" class="menu-mobile">
        <div class="menu-header">
          <img src="assets/img/person_acount.png" alt="conta perfil"
          id="iconUser">
          <p id="nameUser"></p>
          <div id="closeMenu">✖</div>
        </div>

        <ul>
          <li><a href="#how">Como funciona</a></li>
          <li><a  onclick="openModal()" id="openModal">Começar</a></li>
          <div onclick="sairBtn" id="sairBtn">Log out</div>
        </ul>
      </div> -->

      <!-- BOTÃO MENU -->
      <!-- <div id="menu-button" class="menu-btn">☰</div> -->

      <div class="hero__footer-note">Menos de 2 minutos para começar.</div>
    </div>
    <!-- COMO FUNCIONA -->
    <section class="how">
      <h2 id="how" class="section-title">Como funciona?</h2>
      <div class="how-grid">
        <div class="how-item">
          <div class="how-number">1</div>
          <h3>Crie sua conta</h3>
          <p>Leva menos de 1 minuto. Você só precisa informar seus
            objetivos.</p>
        </div>
        <div class="how-item">
          <div class="how-number">2</div>
          <h3>IA analisa seu perfil</h3>
          <p>Nível, experiência, rotina, equipamentos… tudo é considerado
            automaticamente.</p>
        </div>

        <div class="how-item">
          <div class="how-number">3</div>
          <h3>Receba seu treino</h3>
          <p>Um treino completo e otimizado para resultados reais, atualizado
            semanalmente.</p>
        </div>
      </div>
    </section>

    <!-- FEATURES -->
    <section class="features">
      <h2 class="section-title">Por que usar o Azairon?</h2>

      <div class="feature">
        <h2 class="feature__title">Treinos personalizados</h2>
        <p class="feature__text">IA que entende seu corpo, objetivo e
          rotina.</p>
      </div>

      <div class="feature">
        <h2 class="feature__title">Evolução contínua</h2>
        <p class="feature__text">Ajustes automáticos para você crescer com
          segurança.</p>
      </div>

      <div class="feature">
        <h2 class="feature__title">Comunidade ativa</h2>
        <p class="feature__text">Compartilhe resultados, conquistas e receba
          suporte.</p>
      </div>

      <div class="feature">
        <h2 class="feature__title">Acompanhamento inteligente</h2>
        <p class="feature__text">Veja sua evolução e receba recomendações em
          tempo real.</p>
      </div>

      <div class="feature">
        <h2 class="feature__title">Biblioteca de exercícios</h2>
        <p class="feature__text">Vídeos, explicações e execução correta de cada
          movimento.</p>
      </div>
    </section>

    <!-- CTA FINAL -->
    <section class="cta-final">
      <h2>Pronto para transformar seu treino?</h2>
      <p>Crie sua conta e comece seu treino personalizado agora.</p>
      <button onclick="openModal()" class="btn btn--primary btn-big">Começar
        Agora</button>
    </section>
    <div id="toast" class="toast">Login realizado com sucesso!</div>
    <!-- FOOTER -->
    <footer class="footer">
      <p>© 2025 Azairon — Todos os direitos reservados.</p>
    </footer>

    <script type="module">
      // IMPORTS --------------------------------------------------------------

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { 
  getAuth, 
  signOut,
  GoogleAuthProvider, 
  signInWithPopup,
  setPersistence,
  browserLocalPersistence,
  createUserWithEmailAndPassword,
  onAuthStateChanged,
  signInWithEmailAndPassword
} from "https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js";

import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-analytics.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-storage.js";
// CONFIG ---------------------------------------------------------------

const firebaseConfig = {
  apiKey: "AIzaSyAtCaQCMmTUOaguvzW9wkNsCjadgc3klJM",
  authDomain: "azarion-b19c5.firebaseapp.com",
  projectId: "azarion-b19c5",
  storageBucket: "azarion-b19c5.firebasestorage.app",
  messagingSenderId: "217138953652",
  appId: "1:217138953652:web:9c1ebe80b07af13e9006e1",
  measurementId: "G-RS2WV81P8Q"
};

function showToast(message) {
    const toast = document.getElementById("toast");
    toast.textContent = message;
    toast.classList.add("show");

    setTimeout(() => {
        toast.classList.remove("show");
    }, 3000); // some em 3 segundos
}
// INIT GLOBAL  --------------------------------------------------------

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const analytics = getAnalytics(app); // ATIVADO AQUI ✔
const persistence = setPersistence; 
const storage = getStorage(app);



onAuthStateChanged(auth, (user) => {
  if (user) {
    console.log("Usuário restaurado:", user);
    document.querySelector("#nameUser").innerText = user.email;
    document.querySelector("#sairBtn").style.display = "block";
    document.querySelector("#openModal").style.display = "none";
    document.querySelector(".hero__footer-note").style.display = "none";
    document.querySelector(".how").style.display = "none";
    document.querySelector("#iconUser").style.display = "block";
    document.querySelector("#preview").style.display = "block";
    document.querySelector(".features").style.display = "none";
    document.querySelector(".hero__lead").style.display = "none";
    document.querySelector(".cta-final").style.display = "none";
    // usuário está logado
  } else {
    console.log("Nenhum usuário logado.");
  }
});

// PROVIDER GOOGLE ------------------------------------------------------

const provider = new GoogleAuthProvider();

// MODAL ---------------------------------------------------------------

window.openModal = () =>
  document.getElementById("main-modal").style.display = "flex";

window.closeModal = () =>
  document.getElementById("main-modal").style.display = "none";

// TABS ----------------------------------------------------------------

window.showLogin = () => {
  document.getElementById("login-box").style.display = "block";
  document.getElementById("create-box").style.display = "none";
  document.getElementById("tab-login").classList.add("active");
  document.getElementById("tab-create").classList.remove("active");
};

window.showCreate = () => {
  document.getElementById("login-box").style.display = "none";
  document.getElementById("create-box").style.display = "block";
  document.getElementById("tab-create").classList.add("active");
  document.getElementById("tab-login").classList.remove("active");
};

// CREATE ACCOUNT -------------------------------------------------------

document.getElementById("btn-create").addEventListener("click", async () => {
  const apelido = document.getElementById("create-apelido").value;
  const email = document.getElementById("create-email").value;
  const password = document.getElementById("create-password").value;
  try {
    await persistence(auth, browserLocalPersistence);
    await createUserWithEmailAndPassword(auth, email, password);
    // alert("Conta criada com sucesso!");
    showToast("Conta criada com sucesso!");
    const nameUser = document.getElementById("nameUser").innerText = apelido;
    if (nameUser){
      loggedUi(result.user.displayName)
    }
    closeModal();
    showLogin();
  } catch (error) {
    document.getElementById("create-error").textContent = error.message;
  }
});

// LOGIN EMAIL ----------------------------------------------------------
function loggedUi(displayName){
  document.querySelector("#openModal").style.display = "none";
      document.querySelector(".hero__footer-note").style.display = "none";
      document.querySelector(".how").style.display = "none";
      document.querySelector(".features").style.display = "none";
      document.querySelector(".testimonials").style.display = "none";
      document.querySelector(".hero__lead").style.display = "none";
      document.querySelector(".cta-final").style.display = "none";
      document.querySelector("#iconUser").innerText = "block";
      document.querySelector("#preview").innerText = "block";
      document.querySelector(".building").style.display = "block";
      document.querySelector("#sairBtn").style.display = "block";
      document.querySelector("#iconUser").style.display = "block";
}


document.getElementById("btn-login").addEventListener("click", async () => {
  const email = document.getElementById("login-email").value;
  const password = document.getElementById("login-password").value;
  try {
    await persistence(auth, browserLocalPersistence);
    await signInWithEmailAndPassword(auth, email, password);
    // alert("Login realizado com sucesso!");
    const nameUser = document.getElementById("nameUser").innerText = email;
    showToast("Login realizado com sucesso!");
    if (nameUser){
      loggedUi(result.user.displayName)
    }
    closeModal();
  } catch (error) {
    document.getElementById("login-error").textContent = error.message;
  }
});

// LOGIN GOOGLE ---------------------------------------------------------

document.getElementById("google-login").addEventListener("click", async () => {
  try {
    await persistence(auth, browserLocalPersistence);
    const result = await signInWithPopup(auth, provider);
    // alert("Login Google: " + result.user.email);
    const nameUser = document.getElementById("nameUser").innerText = result.user.email;
    showToast("Login realizado com sucesso!");
    if (nameUser){
      loggedUi(result.user.displayName);
    }
    closeModal();
  } catch (error) {
    document.getElementById("login-error").textContent = error.message;
  }
});
//logout
document.getElementById("sairBtn").addEventListener("click", async () => {
  try {
    await signOut(auth);
    alert("Logout realizado com sucesso!");
    location.reload();
  } catch (error) {
    console.error("Erro ao fazer logout:", error);
  }
});

//menu lateral
// --- MENU LATERAL RESPONSIVO ----------------------------------

// const menu = document.getElementById("menu-mobile");
// const btnMenu = document.getElementById("menu-button");
// const btnClose = document.getElementById("closeMenu");
// const logoutMenu = document.getElementById("menu-logout");

// btnMenu.addEventListener("click", () => {
//   menu.style.right = "0";
// });

// btnClose.addEventListener("click", () => {
//   menu.style.right = "-250px";
// });

// logout dentro do menu
logoutMenu.addEventListener("click", async () => {
  try {
    await signOut(auth);
    location.reload();
  } catch (error) {
    alert("Erro ao sair: " + error.message);
  }
});

//foto de perfil
const input = document.getElementById('iconUser');
const preview = document.getElementById('preview');

input.addEventListener('change', async (event) => {
  const file = event.target.files[0];
  if (!file) return;

  // Preview
  preview.src = URL.createObjectURL(file);

  // Referência no storage (melhor: usar o uid do usuário)
  const storage = getStorage();
  const storageRef = ref(storage, `users/${auth.currentUser.uid}/icon.jpg`);

  try {
    // Upload para Firebase
    await uploadBytes(storageRef, file);

    // URL pública para o perfil
    const url = await getDownloadURL(storageRef);

    // Atualiza o perfil do usuário logado
    await updateProfile(auth.currentUser, {
      photoURL: url
    });

    console.log("Icon atualizado:", url);

  } catch (error) {
    console.error("Erro no upload:", error);
  }
});


    </script>
  </body>
</html>